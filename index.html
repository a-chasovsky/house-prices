<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>MathJax example</title>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
</head>

<style>
    body { 
        background-color: #FFFFFF
    }
    h1 {
        font-family: 'Ubuntu';
        color: #26292D;
        font-size: 1.5em;
        font-weight: 600;
        text-align: left;
        line-height: 1.05;
        /* margin-left: 15px; */
        margin-bottom: 0px;
    }
    h2 {
        font-family: 'Ubuntu';
        color: #26292D;
        font-size: 1.3em;
        font-weight: 600;
        text-align: left;
        line-height: 1.05;
        /* margin-left: 15px; */
        margin-top: 20px;
        margin-bottom: 0px;
    }
    h3 {
        font-family: 'Ubuntu';
        color: #26292D;
        font-size: 1.15em;
        font-weight: 600;
        text-align: left;
        line-height: 1.05;
        /* margin-left: 15px; */
        margin-top: 15px;
        margin-bottom: 0px;
    }
    h4 {
        font-family: 'Ubuntu';
        color: #26292D;
        font-size: 1em;
        font-weight: 600;
        text-align: left;
        line-height: 1.05;
        /* margin-left: 12.5px; */
        margin-top: 15px;
        margin-bottom: 0px;
    }
    h5 {
        font-family: 'Ubuntu';
        color: #26292D;
        font-size: 0.85em;
        font-weight: 600;
        text-align: left;
        line-height: 1.05;
        /* margin-left: 12.5px; */
        margin-bottom: 0px;
    }
    t {
        font-family: 'system-ui';
        color: #333333;
        font-size: 1em;
        text-align: justify;
        line-height: 1.5;
        margin-bottom: 1em;
    }
    .text {
        font-family: 'system-ui';
        color: #333333;
        font-size: 1em;
        text-align: justify;
        line-height: 1.5;
    }
    .text085 {
        font-family: 'system-ui';
        color: #333333;
        font-size: 0.85em;
        font-style: italic;
        text-align: justify;
        line-height: 1.5;
        margin-bottom: 25px;
    }
    text-number-toc {
        font-family: 'system-ui';
        font-weight:600;
        color: #333333;
        font-size: 0.85em;
        text-align: justify;
        line-height: 1.5;
    }    
    .horizontal-line {
        height:1px;
        color:#CFD7DE;
        border-width:0;
        width:40%;
        align:center;
        margin-left:37.5%;
        margin-right:0%;
        background-color:#CFD7DE
    }
    
    .verticalLine-left {
        border-left: 0.5px solid #CFD7DE;
        /* margin-bottom: 150px; */
    }
    .verticalLine-right {
      border-right: 0.5px solid #CFD7DE;
    }

    #toc_container {
        background: #FFFDFF;
        border: 1px solid #CFD7DE;
        display: table;
        font-size: 95%;
        margin-bottom: 1em;
        padding: 20px;
        width: auto;
    }
    .toc_title {
        font-weight: 700;
        text-align: left;
        font-family: 'Ubuntu';
        color: #23292F;
    }
    /* unvisited link */
    a:link {
        font-family: 'system-ui';
        text-decoration: none;
        color: #164B84;
    }
    /* visited link */
    a:visited {
        font-family: 'system-ui';
        color: #164B84;
    }
    /* mouse over link */
    a:hover {
        font-family: 'system-ui';
        color: #164B84;
        text-decoration: underline;
    }
    /* selected link */
    a:active {
        font-family: 'system-ui';
      color: #1071C1;
    }
    .spacer75 {
      height: 7.5px;
    }
    .spacer3 {
      height: 3px;
    }
    .bordersLines {
        margin-left: 25%;
        margin-right: 10%;
    }
    /* .bordersHeadTitle {
        margin-left: 30px;
        margin-right: 25%;
    } */
    .bordersContent {
        margin-left: 30px;
        margin-right: 30px;
    }

    ul {
        list-style-type: disc;
        line-height: 1.5;
        margin-top: -5px;
    }
    .picture {
        margin-left: 30px;
    }
    br {
        display: block;
        margin-top: 12.5px;
        line-height:22px;
        content: ' ';
    }

    p {
        margin: 12.5px 0;
    }

    pic-margin {
        margin-left: 30px;
    }

    center {
        display: flex;
        justify-content: center;
    }

    pad {
        padding-left:30px;
        padding-right:25%;
    }

    sb {
        font-weight:600;
    }

    /* .header-container {
      background-color:yellow;
      padding-left:30px;
      padding-right: 25%;
    } */

    /* img {
        width: 100%;
        height: 100%;
      } */

    .header {
        height: 135px;
        background-image: url(img/header.png);
        background-size: contain; /* try other properties here like cover, contain, etc */
        background-repeat: no-repeat;
        padding-left: 30px;
        padding-right: 25%;
        margin-top: 30px;
      }

    #myBtn {
      display: none; /* Hidden by default */
      position: fixed; /* Fixed/sticky position */
      bottom: 20px; /* Place the button at the bottom of the page */
      right: 30px; /* Place the button 30px from the right */
      z-index: 99; /* Make sure it does not overlap */
      border: none; /* Remove borders */
      outline: none; /* Remove outline */
      background-color: red; /* Set a background color */
      color: white; /* Text color */
      cursor: pointer; /* Add a mouse pointer on hover */
      padding: 15px; /* Some padding */
      border-radius: 10px; /* Rounded corners */
      font-size: 18px; /* Increase font size */
    }
    
    #myBtn:hover {
      background-color: #555; /* Add a dark-grey background on hover */
    }

</style>

<body>

    
    
    <button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
    
    <a
        class='anchor'
        id='start'>
        </a>
    <div class='bordersLines'>
        <div class='bordersContent'>


            
<!-- 
            <div class='header-container'>
                <img src='img/header.png' style='width:100%;height:100%;max-width:100%;'>
                    </div> -->
            <div class='header'></div>


            
            
            <br><br>


            
            <h1>
                Комбинирование регрессионнного анализа и машинного обучения для более точных прогнозов и высокой интерпретируемости модели
                </h1>
            </div>

        <div class='bordersContent'>
            <div class='text085'>
                <p>
                    <i>Регрессионный анализ, машинное обучение, описательная аналитика, предиктивная аналитика</i>
                    </p>
                </div>
        
            </div>
        </div>
    <div class='bordersLines'> 
    <div class="verticalLine-left">
    <div class='bordersContent'> 

    <a name="toc"> </a>
    <div id="toc_container">
        <div class='toc_title'>
            Содержание
            </div>
        <div class="spacer75"></div>
         <text> <text-number-toc>1.</text-number-toc> <a href="#review"> Обзор проекта и краткие результаты</a> </text>
        <div class="spacer3"></div>
        <text> <text-number-toc>2.</text-number-toc> <a href="#dataset_description"> Описание датасета</a> </text>
        <div class="spacer3"></div>
        <text> <text-number-toc>3.</text-number-toc> <a href="#missed_values">Работа с отсутствующими значениями</a> </text>
        <div class="spacer3"></div>
        <text> <text-number-toc>4.</text-number-toc> <a href="#model_base">ML-модель №1 (базовая)</a> </text>
        <div class="spacer3"></div>
        <text> <text-number-toc>5.</text-number-toc> <a href="#eda">Исследование данных</a> </text>
        <div class="spacer3"></div>
        <text> <text-number-toc>6.</text-number-toc> <a href="#clear">Очистка данных</a> </text>
        <div class="spacer3"></div>
           &emsp;<text> <text-number-toc>6.1.</text-number-toc> <a href="#discrepancy">Проверка данных на несоответствие</a> </text>
        <div class="spacer3"></div>
            &emsp;<text> <text-number-toc>6.2.</text-number-toc> <a href="#outliers">Выявление и удаление выбросов</a> </text>
        <div class="spacer3"></div>
        <text> <text-number-toc>7.</text-number-toc> <a href="#model_inter1">ML-модель №2 (после очистки данных)</a> </text>
        <div class="spacer3"></div>
        <text> <text-number-toc>8.</text-number-toc> <a href="#feature_engineering">Создание дополнительных предикторов</a> </text>
        <div class="spacer3"></div>
           &emsp;<text> <text-number-toc>8.1.</text-number-toc> <a href="#square_feet">Предикторы, характеризующие площадь</a> </text>
        <div class="spacer3"></div>
           &emsp;<text> <text-number-toc>8.2.</text-number-toc> <a href="#rooms">Предикторы, характеризующие помещения (жилые комнаты, ванные комнаты, кухни)</a> </text>
            <div class="spacer3"></div>
           &emsp;<text> <text-number-toc>8.3.</text-number-toc> <a href="#dates">Предикторы, характеризующие даты</a> </text>
        <div class="spacer3"></div>
        <text> <text-number-toc>9.</text-number-toc> <a href="#preprocessing">Предварительная подготовка данных</a> </text>
        <div class="spacer3"></div>
        <text> <text-number-toc>10.</text-number-toc> <a href="#model_inter2">ML-модель №3 (после создания новых признаков)</a> </text>
        <div class="spacer3"></div>
        <text> <text-number-toc>11.</text-number-toc> <a href="#model_linear">Линейные модели и регрессионный анализ</a> </text>
            <div class="spacer3"></div>
            &emsp;<text> <text-number-toc>11.1.</text-number-toc> <a href="#elastic_net">Эластичная сеть</a> </text>
            <div class="spacer3"></div>
            &emsp;<text> <text-number-toc>11.2.</text-number-toc> <a href="#linear_regression">Линейная регрессия</a> </text>
            <div class="spacer3"></div>
            &emsp;<text> <text-number-toc>11.3.</text-number-toc> <a href="#simulations">Результаты линейных моделей на сэмплированных данных</a> </text>
        <div class="spacer3"></div>
        <text> <text-number-toc>12.</text-number-toc> <a href="#residuals">Выбор ML-модели для прогнозирования остатков линейной регрессии</a> </text>
        <div class="spacer3"></div>
            &emsp;<text> <text-number-toc>12.1</text-number-toc> <a href="#ml_simple">Опорные вектора, бустинги, бэггинг, случайный лес, K-ближайших соседей</a> </text>
        <div class="spacer3"></div>
            &emsp;<text> <text-number-toc>12.2.</text-number-toc> <a href="#vote_stack">Добавление оценщиков верхнего уровня - Voting и Stacking</a> </text>
        <div class="spacer3"></div>
            &emsp;<text> <text-number-toc>12.3.</text-number-toc> <a href="#residuals_final">Сравнение всех моделeй и выбор финального оценщика остатков регрессии</a> </text>
        <div class="spacer3"></div>
            &emsp;<text> <text-number-toc>12.4.</text-number-toc> <a href="#hpp">Комбинирование линейной регрессии и ML-алгоритма - итоговый оценщик HousePricePredictor</a> </text>
        <div class="spacer3"></div>
        <text> <text-number-toc>13.</text-number-toc> <a href="#ml_models">Оценка независимых ML-моделей</a> </text>
        <div class="spacer3"></div>
        <text> <text-number-toc>14.</text-number-toc> <a href="#final_results">Подведение итогов</a> </text>
            <div class="spacer3"></div>
            &emsp;<text> <text-number-toc>14.1.</text-number-toc> <a href="#all_models">Сравнение всех моделей</a> </text>
            <div class="spacer3"></div>
            &emsp;<text> <text-number-toc>14.2.</text-number-toc> <a href="#predicted_actual">Актуальные и спрогнозированные цены</a> </text>
            <div class="spacer3"></div>
            &emsp;<text> <text-number-toc>14.3.</text-number-toc> <a href="#hpp_residuals">Анализ остатков HPP</a> </text>
            <div class="spacer3"></div>
            &emsp;<text> <text-number-toc>14.4.</text-number-toc> <a href="#further">Дальнейшие шаги</a> </text>
            <div class="spacer3"></div>
        </div>
        </div>

    <div class='bordersContent'>
        <h2>
            <a
                class='anchor'
                id='review'>
                </a>
            1. Обзор проекта и краткие результаты
            </h2>
        </div>
    <div class='bordersContent'>
        <h4>
            Цель проекта
            </h4>
        </div>
    <div class='verticalLine-right'>
    <div class='bordersContent'>
    <div class='text'>
        <p>
            Современные алгоритмы машинного обучения обычно превосходят классические линейные модели в точности прогнозов, но при этом сложны в интерпретации. Некоторые алгоритмы имеют встроенный функционал приоритезации предикторов, что позволяет выявить наиболее информативные. Тем не менее, этого недостаточно для оценки взаимосвязей.
            <br><br>
            Целью данного проекта является создание простой в интерпретации модели <sb>HousePricePredictor</sb>, которая по точности прогнозов не уступает лучшим алгоритмами машинного обучения. Модель состоит из двух уровней: на первом уровне используется линейная регрессия для выдачи первичных прогнозов и определения коэффициентов для интерпретации; второй уровень - это алгоритм машинного обучения, прогнозирующий величину остатков (ошибок) регрессии для увеличения тчоности прогнозов. Эта схема во многом напоминает первую итерацию бустинга, в котором каждая последующая итерация минимизирует ошибку предыдущей.
            </p>
        </div>
    <h4>
        Этапы проекта
        </h4>
    <h4>
        <i>Секция 1: Исследование и подготовка данных</i>
        </h4>
    <div class='text'>
        <p>
            На первом этапе проводятся необохдимые процедуры анализа и подготовки данных: заполняются пропущенные значения, выявляются и исправляются противоречия в данных, определяются наиболее значимые предикторы, создаются дополнительные предикторы, осуществляются необходимые преобразования. На каждом этапе преобразования данных обучается промежуточная ML-модель LightGBM.
            </p>
        </div>
    <div class='text'>
        <p>
        <i>Результаты:</i>
            </p>
    </div>
    <ul>
        <li><t>очищенный и преобразованный датасет;</t></li>
        <li><t>датасеты для пайплайнов секции машинного обучения;</t></li>
        <li><t>три промежуточные ML-модели.</t></li>
    </ul>
    <h4>
        <i>Секция 2: Регрессионный анализ</i>
        </h4>
    
    <div class='text'>
        <p>
            В данном разделе проводится исследование эластичной сети и линейной регрессии без регуляризации. Сначала строится эластичная сеть, подбираются оптимальные гиперпараметры и оцениваются разные наборы предикторов. Далее десять наиболее релевантных претикторов используются для обучения простой линейной регрессии без регуляризации, которая и будет использоваться на первом уровне итогового оценшика HPP. В заключении проводится диагностика получившейся регерссии и сравнение её с эластичной сетью на сэмплированных данных.
            </p>
        </div>
<div class='text'>
    <p>
        <i>Результаты:</i>
        </p>
</div>
<ul>
    <li><t>линейная модель первого уровня итогового оценщика HPP</t></li>
    <li><t>эластичная сеть для сравнения с другими моделями.</t></li>
</ul>
    <h4>
        <i>Секция 3: Машинное обучение</i>
        </h4>
    
        <div class='text'>
            <p>
                Секция машинного обучения состоит из двух частей.
                <br><br>
                В первой части осуществляется выбор алгоритма, который будет прогнозировать <sb>остатки</sb> (ошибки) линейной регрессии. Его прогнозы в дальнейшем используются для коррекции прогнозов регрессии, что теоретически должно привести к улучшению точности предсказания цены. Для оценки лучшего алгоритма используется 20-фолдовая перекрестная проверка.
                <br><br>
                Во второй части секции по той же схеме с 20-фолдовой кросс-валидацией выбирается лучшая модель машинного обуения для прогноза <sb>цены</sb> домов. Эта модель - очередной бенчмарк эффективности (в дополнение к моделям из предыдущих секций) для итогового оценщика HPP.
                </p>
            </div>
    <div class='text'>
        <p>
            <i>Результаты:</i>
            </p>
    </div>
    <ul>
        <li><t>ML-модель для прогноза остатков регрессии;</li></t>
        <li><t>ML-модель для прогноза цены дома.</t></li>
        </ul>
    <h4>
        <i>Секция 4: Подведение итогов</i>
        </h4>
    
    <div class='text'>
        <p>
        На заключительном этапе проводится сравнение имеющихся моделей, делается заключение об эффективности оценщика HPP, исследуются остатки его прогнозов, предлагаются шаги для дальнейшего исследования данных и развития структуры HPP.
            </p>
        </div>
    <div class='text'>
        <p>
            <i>Результаты:</i>
            </p>
        </div>
    <ul>
        <li><t>оценка HPP;</t></li>
        <li><t>рекомендации по дальнейшим шагам.</t></li>
    </ul>
    <h4>
        Краткие результаты
        </h4>
    <h4>
        <i>Предсказательная эффективность HousePricePredictor (HPP)</i>
        </h4>
    <div class='text'>
        <p>
            График показывает эффективность прогнозирования семи моделей, построенных на разных стадиях проекта.
            </p>
        </div>
    <ul>
        <li><t>Base - базовая модель LightGBM после удаления пропусков;</t></li>
        <li><t>Base (Clean) - промежуточная модель LightGBM после очистки данных;</t></li>
        <li><t>Base (FE) - промежуточная модель LightGBM после генерации новых признаков;</t></li>
        <li><t>Elastic Net - лучшая регрессионная модель (эластичная сеть);</t></li>
        <li><t>SVM - лучшая линейная модель;</t></li>
        <li><t>Stacking - лучшая ML-модель;</t></li>
        <li><t>HousePricePredictor(HPP) - модель, полученная в результате комбинации линейной регрессии и стэкинга.</t></li>
    </ul>
    <center>
        <img src='img/Section8-Final-predictions/final_plot.png'>
        </center>
        <p>
            В ходе проекта удалось снизить ошибку RMSE c 0.1216 у базовой модели до 0.0969 итогового оценщика HousePricePredictor. На этапе преобразования наибольший вклад внесла очистка данных, а дополнительно сгенерированные предикторы были полезны как для линейной регрессии, так и для сложных алгоритмов машинного обучения (см. <i>'8. Создание дополнительных предикторов'</i>, <i>'11.2. Линейная регрессия'</i>, <i>'13. Оценка независимых ML-моделей'</i>).
            <br><br>
            Результат итогового оценщика HPP превысил ожидания - это единственная модель, у которой ошибка на тестовых данных меньше 0.1. Доверительные интервалы средней ошибки и предиктивные интервалы у всех моделей примерно одинаковы.
            <br><br>
            Три лучшие модели демонстрируют неплохой разброс - их прогнозы достаточно кучны, за исключением нескольких выбросов, хорошо заметных на нижнем графике. Для HPP это пять элементов с заметно более высоким значением ошибки.
            </p>
    <h4>
        <i>Интерпретациия</i>
        </h4>
    <div class='text'>
        <p>
            Ядром HousePricePredictor является линейная регрессия. Коэффициенты и доверительные интервалы представлены в таблице ниже.
            </p>
        </div>
    <br><br>
    <center>
        <img src='img/Section4-Linear-models-research/coefficients_table.png'>
    </center>
    <br><br>
    <div class='text'>
        <p>
            Предикторы с наибольшим коэффициентом - это дополнительно сгенерированный предиктор <sb>lg_flrsfmean</sb> (средневзвешенная площадь первого и второго этажей, см. <i>'8.1. Предикторы, характеризующие площадь'</i>), общее качество строительных и отделочных материалов <sb>overallqual</sb>, возраст дома <sb>houseage</sb>. Вклад, котоый вносит увеличение этих параметров в изменение цены дома (при прочих равных):
    </p>
    </div>
    <ul>
        <li><t>С увеличением средневзвешенной площади этажей на 1% цена увеличивается на 0.144%;</t></li>
        <li><t>С увеличением качества материалов на 1 пункт цена увеличивается на 8.8%;</t></li>
        <li><t>С увеличением возраста дома на 1 год цена уменьшается на 8.5%</t></li>
    </ul>
    <div class='text'>
        <p>
            Интерпретацию остальных коэффцииентов см. в разделе <i>'11.2. Линейная регрессия'.</i>
            </p>
        </div>
    <h4>
        <i>Сравнение актуальных и предсказанных HousePricePredictor цен</i>
        </h4>
    <br><br>
    <img src='img/Section8-Final-predictions/predicted_actual_residuals.svg'>
    <div class='text'>
        <p>
            На оси абсцисс - элементы, отсортированные по суммарной площади жилого пространства <sb>grlivarea</sb>. С увеличением площади увеличивается цена дома. Этот график можно разбить на три составляющие: малые, средние и большие дома.
        </p>
        </div>   
    <div class='text'>
        <p>
            В первой части для небольших домов значения ошибок невелики, и модель чаще переоценивает дома. На среднем отрезке ошибки увеличиваются, предсказания модели выравниваются. На финальном отрезке для больших домов вновь чаще наблюдается переоценка, а ошибки в абсолютных величинах иногда превышают 50000$.
            </p>
        </div>  
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h2>
        <a
            class='anchor'
            id='dataset_description'>
            </a>
        2. Описание датасета
        </h2>
<div class='text'>
    <p>
        В проекте используется один из датасетов Kaggle. Это типичная задача регрессии, в которой требуется спрогнозировать стоимость дома, используя для этого значения его характеристик и исторические данные о предыдущих сделках.
        </p>
    </div>
    <a
        href='https://www.kaggle.com/competitions/house-prices-advanced-regression-techniques/overview'
        >Перейти к странице датасета на сайте Kaggle
        </a>
<div class='text'>
    <p>
        Число предикторов: 79;<br>
        Число элементов: 1460;
        </p>
    </div>
<div class='picture'>
    <img src='img/Section1-Overview-and-Base-model/data_raw.png'>
    </div> 
<div class='text'>
    <p>
        После разделения датасета на обучающий (train) и проверочный (test), число элементов составило 1314 и 146 соответственно.
        </p>
    </div>
    <h4>
        <i>Целевая переменная</i>
        </h4>     
<div class='text'>
    <p>
        Распределение целевой переменной напоминает гамма-распределение. Это одномодальное распределение с вершиной в районе 150000$ и правосторонней ассиметрией.
        </p>
    </div>
    <div class='picture'>
        <img src='img/Section1-Overview-and-Base-model/target_distribution.png'>
        </div>
    <div class='text'>
        <p>
            Для выравнивания формы распределения и снижения влияния экстремальных значений используется натуральный логарифм.
            </p>
        </div>
    <div class='picture'>
            <img src='img/Section1-Overview-and-Base-model/target_distribution_log.png'>
        </div>
    <h4>
        <i>Характеристики</i>
        </h4>
<div class='text'>
    <p>
        В датасете 79 независимых переменных:
        </p> 
    </div>
    <ul>
        <li><t>Количественных признаки - 34;</t></li>
        <li><t>Порядковые признаки - 18;</t></li>
        <li><t>Категориальные признаки - 27.</t></li>
    </ul>         
    <h4>
        <i>Группы предикторов</i>
        </h4>
    <div class='text'>
        <p>
            Для более детального анализа в ходе работы предикторы разделяются на группы, соответствующие общей логике. Этот подход полезен для генерации дополнительных признаков, являющихся производными от основных характеристик, а также в овремя очистки и проверки данных на логические противоречия.
            <br><br>
            Всего сформировано 12 категорий предикторов:
            </p>
        </div>
    <ul>
        <li><t>Общая оценка качества</t></li>
        <li><t>Гараж</t></li>
        <li><t>Подвал</t></li>
        <li><t>Предикторы, связанные с площадью</t></li>
        <li><t>Комнаты</t></li>
        <li><t>Год постройки дома/гаража, модернизации, и т.д.</t></li>
        <li><t>Двор и область вокруг дома</t></li>
        <li><t>Строительный материал</t></li>
        <li><t>Конструкционные особенности</t></li>
        <li><t>Состояние (износ)</t></li>
        <li><t>Удобства</t></li>
        <li><t>Окружение (район, улица, и т.д.)</t></li>
        <li><t>Организационные аспекты продажи</t></li>
    </ul>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
     <h2>
        <a
            class='anchor'
            id='missed_values'>
            </a>
        3. Работа с отсутствующими значениями
        </h2>
    <h4>
        <i>Категориальные переменные</i>
        </h4>   
    <div class='text'>
        <p>
            На первый взгляд у некоторых категориальных переменных число пропущенных значений крайне велико и достигает почти 100% от общего числа элементов.
            <br><br>
            <i>Порядковые</i>
            </p>
        </div>
    <div class='picture'>
            <img src='img/Section1-Overview-and-Base-model/categorical_ordinal.png'>
        </div>
    <div class='text'>
        <p>
            <i>Номинативные</i>
            </p>
        </div>
    <div class='picture'>
            <img src='img/Section1-Overview-and-Base-model/categorical_categorical.png'>
        </div>
    <div class='text'>
        <p>
            <i>Заполнение пропусков</i>
            </p>
        </div>
    <div class='text'>
        <p>
            Большое количество пропусков объясняется тем, что большинство NaN в этом датасете эквивалентны значению "Отсутствует" (к примеру, NaN для переменной "бассейн" означает, что в этом доме отсутствует бассейн). После приведения данных в соответствие с описанием и замены NaNs на 'NA' осталось только одно пропущенное значение в переменной <b>electrical</b> (заполняется медианным значением).
            </p>
        </div>
    <h4>
        <i>Количественные переменные</i>
        </h4> 
    <div class='text'>
        <p>
            У трех количественных переменных присутствуют пропущенные значения: <b>lotfrontage</b>, <b>garageyrblt</b>, <b>masvnrarea</b>.
            </p>
        </div>
    <div class='picture'>
            <img src='img/Section1-Overview-and-Base-model/quantitative.png'>
        </div>
    <div class='text'>
        <p>
            <ul>
                <li><t><b>lotfrontage</b> - длина участка улицы, соприкасающейся с придомовой территорией</t></li>
            </ul>
            237 (18%) пропущенных значений, пропуски заполняются медианным значением. Дополнительно обнаружены два потенциальных выброса (выделены красным).
            </p>
        </div>
    <div class='picture'>
            <img src='img/Section1-Overview-and-Base-model/lotfrontage_outs.png'>
        </div>
    <div class='text'>
        <p>
            <ul>
                <li><t><b>garageyrblt</b> - год постройки гаража</t></li>
            </ul>
            73 (6%) пропущенных значений. Пропуски заполняются годом постройки дома.
            </p>
        </div>
    <div class='text'>
        <p>
            <ul>
                <li><t><b>masvnrarea</b> - площадь облицовки фундамента</t></li>
            </ul>
            8 (1%) пропущенных значений. Более детальное исследование показывает, что все пропуски соответствуют отсутствию облицовки (перменная <b>masvnrtype</b> со значением NA). Соответственно, пропущенные значения площади для этих элементов заполняются нулевыми значениями.
            </p>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h2>
        <a
            class='anchor'
            id='model_base'>
            </a>
        4. ML-модель №1 (базовая)
        </h2>
    <div class='text'>
        <p>
            LightGBM используется в качестве базовой ML-модели как оптимальный с точки зрения эффективности и производительности.    
            <br>
            Катеориальные признаки кодируются с помощью <b>OrdinalEncoder</b> из библиотеки Feature-engine (категории заменяются целыми числами, порядок которых определяется согласно возрастанию среднего значения целевой переменной).
            <br>
            Подбор гиперпараметров проводится в два этапа. На первом этапе тестируется широкий диапазон значений и определяется базовые параметры. После этого проводится еще один поиск в окрестностях базовых параметров. В обоих случаях используется <b>GridSearch</b> от Scikit-learn с <b>20-fold</b> кросс-валидацией.
            <br>
            Чтобы предотвратить утчеку данных во время подбора гиперпараметров используется <b>Pipeline</b> от Scikit-learn.
            <br>
            Метрика качества модели - <b>RMSE</b> (среднеквадратичная ошибка).
            </p>
        </div>    
    <h4>
        <i>Результаты 1-го этапа подбора гиперпараметров</i>
        </h4> 
    <div class='text'>
        <p>
            Лучшие результаты (RMSE в районе 0.130) показывают сложные модели с большим числом деревьев (> 25), увеличение числа листьев также положительно сказывается на эффективности модели. Оптимальная скорость обучения - 0.1. RMSE лучшей модели - 0.1282.
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section1-Overview-and-Base-model/gridsearch1.png'>
        </div> 
    <h4>
        <i>Результаты 2-го этапа подбора гиперпараметров</i>
        </h4> 
    <div class='text'>
        <p>
            Ошибка уменьшилась незначительно - с 0.1282 до 0.1276.
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section1-Overview-and-Base-model/gridsearch2.png'>
        </div>
    <h4>
        <i>ML-модель №1 (базовая)</i>
        </h4>
    <div class='text'>
        <p>
            Таким образом, базовая модель (RMSE: 0.1276) имеет следующую конфигурацию:
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section1-Overview-and-Base-model/model_1.png'>
        </div>
    <div class='text'>
        <p>
            Это первый ориентир относительного того, насколько имеющиеся данные подходят для предсказания цены домов. Дополнительно базовая модель дает представление о наиболее значимых предикторах. Отметим, что 7 из 10 ключевых предикторов - это площадь того или иного помещения продаваемого дома. На общем фоне заметно выделяется суммарная площадь жилого пространства (<b>grlivarea</b>). 
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section1-Overview-and-Base-model/feature_importance.png'>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h2>
        <a
            class='anchor'
            id='model_base'>
            </a>
        5. Исследование данных
        </h2>
    <h4>
        <i>Матрица корреляций</i>
        </h4> 
    <div class='text'>
        <p>
            Матрица корреляций деомнстрирует линейные взаимосвязи предикторов с целевой переменной. В топ-10 наиболее влияющих признаков в основном оценки площади и качества различных составляющих дома.
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/corr_matrix.png'>
        </div>
    <div class='text'>
        <p>
            Полный набор различных визуализаций представлен в соответсвующем блокноте _Section2-Explore-and-Clean.ipynb_. Ниже приведены несколько типовых графиков.
            </p>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h4>
        <i>Количественные признаки</i>
        </h4>
    <div class='text'>
        <p>
            Ключевые инструменты для исследования количественных переменных - гистограммы и диаграммы рассеяния с добавлением линии регрессии.
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/quantitative.png'>
        </div>
    <h4>
        <i>Категориальные признаки</i>
        </h4>
    <div class='text'>
        <p>
            Ключевые инструменты для исследования катеориальных переменных - диаграмма рассеяния с лининей регрессии и точечная диаграмма.
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/ordinal.png'>
        </div>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/categorical.png'>
        </div>
    <div class='text'>
        <p>
            Примеры взаимосвязи некоторых категориальных переменных с ценой
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/housestyle.png'>
        </div>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/kitchenqual_vs_price.png'>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h2>
        <a
            class='anchor'
            id='model_base'>
            </a>
        6. Очистка данных
        </h2>
    <h3>
        <a
            class='anchor'
            id='discrepancy'>
            </a>
        6.1. Проверка данных на несоответствие
        </h3>
    <div class='text'>
        <p>
            В этом пункте данные проверяются на логическое несоответствие. Например, суммарная площадь жилого пространства не может быть меньше суммарной площади всех комнат.
            <br><br>
            Всего проверено 33 предиктора, несоответствия найдены в двух переменных: <b>masvnarea</b> и <b>garageyrblt</b>.
            </p>
        </div>
    <div class='text'>
        <p>
            <b> GARAGEYRBLT </b> (год постройки гаража) 
            </p>
        </div>
    <div class='text'>
        <p>
            <i>Несоответствия:</i>
            <br><br>
            <ul>
                <li><t>У 6 элементов год постройки гаража меньше года постройки дома. В некоторых случаях эта разница составляет несколько лет.</t></li>
                </ul>
            <i>Возможная причина:</i>
            <br><br>
            <ul>
                <li><t>Сооружение гаража может быть первым этапом строительства, но после его постройки возможна заморозка стройки, к примеру, из-за финансовых трудностей. Соответственно, сам дом будет достроен только через несколько лет. Такое несоответсвие допускается.</t></li>
                </ul>
            <i>Решение:</i>
            <br><br>
            <ul>
                <li><t>Данные не исправляются.</t></li>
                </ul>
        </p>
        </div>
    <div class='text'>
        <p>
            <b> MASVNAREA </b> (Площадь облицовки фундамента)
            </p>
        </div>
<div class='text'>
        <p>
            <i>Несоответствия:</i>
            <br><br>
            <ul>
                <li><t>У 7 элементов площадь облицовки равна 0, при этом тип облицовки не NA, и наоборот (см. таблицу выше).</t></li>
                </ul>
            <i>Возможная причина:</i>
            <br><br>
            <ul>
                <li><t>Ошибка ввода данных.</t></li>
                </ul>
            <i>Решение:</i>
            <br><br>
            <ul>
                <li><t>Исправление вручную. Во время исправления ошибок в данных в первую очередь будем ориентироваться на тип облицовки (<b>masvntype</b>) и цену дома (<b>price</b>). На графике ниже видно, что наиболее дорогие - это дома с облицовкой из камня (Stone) и кирпича (BrkFace).</t></li>
                </ul>
        </p>
        </div>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/masvnrtype_price.png'>
        </div>
    <div class='text'>
        <p>
            В данных присутствует три типа противоречий, каждое будет рассмотрено отдельно, и соответственно будут исследованы три группы элементов.
            </p>
        </div>
    <h4>
        <i>Элементы с индексом 1230 и 733</i>
        </h4>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/1230_773.png'>
        </div>
<div class='text'>
        <p>
            <i>_Противоречие:</i>
            <br><br>
            <ul>
                <li><t>Если <b>masvntype</b> равен NA, то <b>masvnrarea</b> должна быть равна 0.</t></li>
                </ul>
            <i>Варианты исправления:</i>
            <br><br>
            <ul>
                <li><t>Или <b>masvntype</b> присываивается какое-то значение, или <b>masvnrarea</b> приравнивается к 0.</t></li>
                </ul>
            <i>Решение:</i>
            <br><br>
            <ul>
                <li><t><b>masvnrarea</b> приравнивается к 0.</t></li>
                </ul>
            <i>Аргументы:</i>
            <br><br>
            <ul>
                <li><t>Цены этих двух домов в районе 12.0 - это аргумет в пользу того, что облицовка отсутствует (так как средняя цена домов без облицовки - 11.9).</t></li>
                <li><t>Наименьшее значение переменной <b>masvnarea</b> - 10 (см. график ниже); в данном случае 1 - это вероятно ошибка ввода данных.</t></li>
                </ul>
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/masvnrarea_minimal.png'>
        </div>
    <h4>
        <i>Элементы с индексом 1241 и 688</i>
        </h4>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/688_1241.png'>
        </div>
<div class='text'>
        <p>
            <i>_Противоречие:</i>
            <br><br>
            <ul>
                <li><t>Если <b>masvnrarea</b> равна нулю, то <b>masvntype</b> должен быть равен NA.</t></li>
                </ul>
            <i>Варианты исправления:</i>
            <br><br>
            <ul>
                <li><t>Или <b>masvnrarea</b> приравнивается какое-либо значение, или <b>masvntype</b> присываивается NA.</t></li>
                </ul>
            <i>Решение:</i>
            <br><br>
            <ul>
                <li><t><b>masvnrarea</b> присваивается медианное значение элементов, имеющих соответствующее <b>masvntype</b>.</t></li>
                </ul>
            <i>Аргументы:</i>
            <br><br>
            <ul>
                <li><t>Цена элементов с нулевой <b>masvnrarea</b> достаточно большая, говорит скорее в пользу наличия облицовки (т.е. в пользу того, что <b>masvnrarea</b> не равна нулю), поэтому <b>masvnrarea</b> заполняется медианным значением, соответствующим типу <b>masvntype</b>.</t></li>
                </ul>
            </p>
        </div>
    <h4>
        <i>Элементы с индексом 624, 1300 и 1334</i>
        </h4>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/624_1300_1334.png'>
        </div>
<div class='text'>
        <p>
            <i>_Противоречие:</i>
            <br><br>
            <ul>
                <li><t>Если <b>masvnrarea</b> не равна нулю, то <b>masvntype</b> не должен быть NA.</t></li>
                </ul>
            <i>Варианты исправления:</i>
            <br><br>
            <ul>
                <li><t>Или <b>masvntype</b> присываивается какое-то значение, или <b>masvnrarea</b> приравнивается к 0.</t></li>
                </ul>
            <i>Решение:</i>
            <br><br>
            <ul>
                <li><t>Элементы 624 и 1334: <b>masvnrarea</b> приравнивается к 0;</t></li>
                <li><t>Элемент 1300: <b>masvntype</b> присваивается значение Stone.</t></li>
                </ul>
            <i>Аргументы:</i>
            <br><br>
            <ul>
                <li><t>Для всех трех элементов выбор сделан исходя из их цены - у дорогих домов чаще встречается <b>masvntype</b>, равный Stone, у недорогих - NA.</t></li>
                </ul>
            </p>
        </div>
    <h4>
        <i>Исправленные данные</i>
        </h4>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/masvnrarea_fixed.png'>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h3>
        <a
            class='anchor'
            id='outliers'>
            </a>
        6.2. Выявление и удаление выбросов
        </h3>
    <div class='text'>
        <p>
            Два подозрительно высоких значения <b>lotfrontage</b>, обнаруженных при исследовании количественных признаков.
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/lotfrontage.png'>
        </div>  
    <div class='text'>
        <p>
            Помимо этого потенциальные выбросы обнаружены в некотрых других переменных. К примеру, так выглядит диаграмма для переменной <b>miscval</b>:
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/miscval.png'>
        </div>
    <div class='text'>
        <p>
            Далее формируется список потенциальных выброосв и строятся диаграммы, на которых подозрительные элементы выделены цветом.
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/outliers_colored.png'>
        </div>
    <div class='text'>
        <p>
            После визуальной оценки три элемента (индексы 523, 934 и 1298) признаются выбросами и удаляются из датасета. 
            </p>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h2>
        <a
            class='anchor'
            id='model_inter1'>
            </a>
        7. ML-модель №2 (после очистки данных)
        </h2>
    <div class='text'>
        <p>
            Здесь применяется тот же двухэтапный подход, что и в пункте _4. ML-модель №1 (базовая)_. Лучшая модель демонстрирует RMSE на уровне 0.1233 (у базовой мдоели RMSE равна 0.1276). Конфигурация модели выглядит следующим образом:
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/model_2.png'>
        </div>
    <div class='text'>
        <p>
            По сравнению с базовой моделью число деревьев не изменилось, глубина дерева уменьшалсь почти в три раза, а количество листьев сократилось более чем в 10 раз. Модель стала проще и эффективнее. 
            <br><br>
            Очистка и исправление данных несколько сгладили значимость предикторов по сравнению с сырыми данными - по-прежнему лидирует предиктор, характеризующий суммарную жилую площадь __grlivarea__.
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section2-Explore-and-Clean/feature_importance.png'>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h2>
        <a
            class='anchor'
            id='feature_engineering'>
            </a>
        8. Создание дополнительных предикторов 
        </h2>
    <div class='text'>
        <p>
            На данном этапе предикторы разбиваются на __группы__ и продолжается процесс исследования датасета. Изучается возможность создания дополнительных предикторов, которые гипотетически способны повысить эффективность модели.
            </p>
        </div>
    <h3>
        <a
            class='anchor'
            id='square_feet'>
            </a>
        8.1. Предикторы, характеризующие площадь
        </h3>
    <div class='text'>
        <p>
            Два подозрительно высоких значения <b>lotfrontage</b>, обнаруженных при исследовании количественных признаков.
            </p>
        </div>
    <div class='text'>
        <p>
            Исследованы 17 предикторов и сгенерирован 1 дополнительный - __flsrmean__.
            <br><br>
            Согласно матрице корреляций наиболее информативным предиктором в данной группе является суммарная площадь жилых помещений __grlivarea__ с коэффициентом корреляции 0.72 (для очищенных данных). Этот показатель рассчитывается как сумма жилых площадей первого и второго этажа и по  сути эквивелентен их среднему арифметическому.
            <br><br>
            Гипотеза, лежащая в основе нового предиктора __flrsfmean__: для большинства жителей относительная ценнность первого этажа выше, чем второго. Это объясняется тем, что на втором этаже расположены преимещественно спальни, и люди в целом проводят больше времени на первом этаже. Чтобы учесть этот эффект, вместо среднего арифметического рассчитывается среднее взвешенное:
            </p>
        </div>
    <div class='text'>
        <p>
            $$ flrsfmean = \frac{first\_flrsf*weight_1 + second\_flrsf*weight_2}{weight_1 + weight_2} , $$
            <br><br>
            <p>где \[ \mathit{weight_1} \] и \[ \mathit{weight_3} \] - это веса первого и второго этажа соответственно.</p>
            <br><br>
            После нескольких тестов веса принимаются равными 1 и 0.7. Итоговая формула выглядит следующим образом:
            <br><br>
            $$ flrsfmean = \frac{first\_flrsf + second\_flrsf*0.7}{1.7} $$
            <br><br>
            Коэффициент корреляции нового предиктора __flrsfmean__ равен 0.77 - это на 0.05 выше, чем у наиболее информатичного количественного предиктора __grlivarea__. В дополнение к этому, __flrsfmean__ имеет мéньшую дисперсию.
            </p>
        </div>
    <div class='picture'>       
        <img src='img/Section3-Feature-selection-and-Preprocessing/flrsfmean.png'>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h3>
        <a
            class='anchor'
            id='rooms'>
            </a>
        8.2. Предикторы, характеризующие помещения (жилые комнаты, ванные комнаты, кухни)
        </h3>
    <div class='text'>
        <p>
            Исследованы 7 предикторов, сгенерировано 5 дополнительных - <b>bedroomsize</b>, <b>kitchensize</b>, <b>bedroomfracrms</b>, <b>kitchenfracrms</b>, <b>bathsfracbedr</b>. 
            <br><br>
            Наиболее информативный предиктор этой группы - <b>fullbath</b> (0.58), который показывает количество совмещенных ванных комнат. Новые предикторы можно разделить на три группы:
            <ul>
                <li><t><b>bedroomsize</b>, <b>kitchensize</b>: относительный размер спален и кухонь от площади - рассчитывается как количество спален/кухонь, деленное на общую площадь жилых помещений (<b>grlivarea</b>);</t></li>
                <li><t><b>bedroomfracrms</b>, <b>kitchenfracrms</b>: относительный размер спален и кухонь от общего числа комнат - рассчитывается как количество спален/кухонь, деленное на общее число комнат (<b>totrmsabvgrd</b>);</t></li>
                <li><t><b>bathsfracbedr</b>: относительное число ванных комнат - рассчитывается как число совмещенных ванных комнат, деленное на число спален (<b>bedroomabvgr</b>).</t></li>
                </ul>
            Наиболее информативным из новых признаков является относительный размер кухни (<b>kitchensize</b>, коэффициент корреляции: -0.71).
            <div class='picture'>       
                <img src='img/Section3-Feature-selection-and-Preprocessing/bedroom_kitchen.png'>
                </div>
            </p>
        </div>
    <h3>
        <a
            class='anchor'
            id='dates'>
            </a>
        8.3. Предикторы, характеризующие даты
        </h3>
    <div class='text'>
        <p>
            Посчитаны и добавлены новые предикторы <b>houseage</b> (возраст дома на момент продажи) и <b>modage</b> (число лет с момента модернизации на момент продажи). Они не повышают информативность, но более удобны для интерпретации.
            </p>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h2>
        <a
            class='anchor'
            id='preprocessing'>
            </a>
        9. Предварительная подготовка данных
        </h2>  
    <div class='text'>
        <p>
            <i>Первые пять эелементов данных до преобразования</i>
            <div class='picture'>       
                <img src='img/Section3-Feature-selection-and-Preprocessing/data_raw.png'>
                </div>
            <h4>
                <i>Количественные переменные</i>
                </h4>
            Количественные предикторы логарифмируются (натуральный логарифм) с помощью <b>LogCpTransformer</b> из библиотеки Feature-engine. Предварительно к каждому значению добавляетя константа C, равная 1. В название всех логарифимрованных предикторов добавляется приставка <b>lg_</b>.
            <br><br>
            <div class='picture'>       
                <img src='img/Section3-Feature-selection-and-Preprocessing/data_log.png'>
                </div>
            Матрица корреляций после добавления новых предикторов приведена ниже. Единственный признак, отрицательно коррелирующий с целевой перменной - относительный размер кухни <b>kitchensize</b>.
            <br><br>
            <div class='picture'>       
                <img src='img/Section3-Feature-selection-and-Preprocessing/corr_matrix_new.png'>
                </div>
             <h4>
                <i>Категориальные переменные</i>
                </h4>
            Для преобразования категориальных переменных используется <b>OrdinalEncoder</b> из библиотеки Feature-engine. Он присваивает переменным порядковые целочисленные значения (0, 1, 2, 3, и т.д.). Порядок определяется средним значением целевой переменной (0 - для элементов с наименьшим средним и далее по возрастанию). 
            <br><br>
            <div class='picture'>       
                <img src='img/Section3-Feature-selection-and-Preprocessing/data_encoded.png'>
                </div>
            <h4>
                <i>Стандартизация</i>
                </h4>
            После этого данные стандартизируются с помощью <b>StandardScaler</b> из библиотеки Scikit-learn.
            <br><br>
            <div class='picture'>       
                <img src='img/Section3-Feature-selection-and-Preprocessing/data_scaled.png'>
                </div>
            </p>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h2>
        <a
            class='anchor'
            id='model_inter2'>
            </a>
        10. ML-модель №3 (после создания новых признаков)
        </h2>
     <div class='text'>
        <p>
            Добавление новых предикторов практически не оказало влияния на эффективность модели (RMSE уменьшилась с 0.1233 до 0.1230). Число деревьев и листьев не изменились, а глубина деревьев увеличилась в два раза.
            <br><br>
            <div class='picture'>       
                <img src='img/Section3-Feature-selection-and-Preprocessing/model_3.png'>
                </div>
             Теперь считает самым информативным предиктором является вновь созданный __flrsfmean__ (это соответствует его высокому коэффициенту корреляции). В топ-10 наиболее значимых признаков также попал новый предиктор __bedroomsize__.
             <br><br>
             <div class='picture'>       
                <img src='img/Section3-Feature-selection-and-Preprocessing/feature_importance.png'>
                </div>
            </p>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>  
    <h2>
        <a
            class='anchor'
            id='model_linear'>
            </a>
        11. Линейные модели и регрессионный анализ
        </h2>
    <h3>
        <a
            class='anchor'
            id='elastic_net'>
            </a>
        11.1. Эластичная сеть
        </h3>
    <div class='text'>
        <p>
            К текущему моменту мы получили представление о наиболее значимых предикторах благодаря встроенному функционалу LightGBM и матрице корреляций. В данном пункте мы обучим эластичную сеть, оценим влияние регуляризации и посмотрим, какие предикторы выбирает сеть в зависимости от величины параметра регуляризации.
            <br><br>
            Отобразим пространство значений гиперпараметра $\alpha$
            <br><br>
            <div class='picture'>       
                <img src='img/Section4-Linear-models-research/alphas_logspace.png'>
                </div>
            Выполним поиск по сетке гиперпараметров __GridSearch__ и отобразим результаты на графике. В рамках исследуемых данных лучшую предиктивную эффективность показывает минимальная регуляризация.
            <br><br>
            <div class='picture'>       
                <img src='img/Section4-Linear-models-research/regularization.png'>
                </div>
            Теперь посмотрим, какие предикторы выбирает эластичная сеть в зависимости от величины $\alpha$, и какое влияние это оказывает на эффективность модели.
            <br><br>
            <div class='picture'>       
                <img src='img/Section4-Linear-models-research/features_plot.png'>
                </div>
            Чем ниже параметр регуляризации, тем выше эффективность прогнозирования. Минимальное число предикторов эластичной сети - 3, это уже известные __lg_flrsfmean__, __neighborhood__, __overallqual__. Ошибка резко уменьшается при увеличинии количества предикторов с 3 до 8, заметно снижается при изменении их с 8 до 33, и плавно снижается после увеличения до 88. С точки зрения баланса точности прогнозов и интерпретируемости, оптимальное количество предикторов находится где-то между 8 и 33. Необходимо также учитывать тот факт, что после отметки в 14 признаков показатель мультиколлинеарности __VIF__ увеличивается многократно и выходит за допустимые рамки (см. таблицу ниже). 
            <br><br>
            <i>Изменение набора предикторов в зависмости от величины параметра регуляризации $\alpha$</i>
            <div class='picture'>       
                <img src='img/Section4-Linear-models-research/features_by_alpha.png'>
                </div>
            Отметив эти особенности, можно переходить к следующему пункту - построению линейной регрессии, которая станет ядром HousePricePredictor.
            </p>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h3>
        <a
            class='anchor'
            id='linear_regression'>
            </a>
        11.2. Линейная регрессия
        </h3>
    <div class='text'>
        <p>
            Предикторы должны соответствовать следующим требованиям:
            <br><br>
            <ul>
                <li><t>Они удобны в интерпретации и понятны любому пользователю;</t></li>
                <li><t>Они входят в состав наиболее информативных предикторов эластичной сети;</t></li>
                <li><t>Они статистически значимы на уровне $\alpha$, равном 0.05;</t></li>
                <li><t>Включение дополнительного признака в модель увеличивает скорректированный коэффициент детерминации $R^{2}_{adj}$.</t></li>
            </ul>
            В итоге выбраны следующие предикторы:
            <br><br>
            <ul>
                <li><t><b>lg_flrsfmean</b> - средневзвешенная площадь этажей;</t></li>
                <li><t><b>lg_lotarea</b> - площадь придомовой территории;</t></li>
                <li><t><b>overallqual</b> - оценка качества дома;</t></li>
                <li><t><b>kitchenqual</b> - оценка качества кухни;</t></li>
                <li><t><b>exterqual</b> - оценка качества материала фасада;</t></li>
                <li><t><b>bsmtqual</b> - оценка качества подавала;</t></li>
                <li><t><b>overallcond</b> - оценка состояния дома;</t></li>
                <li><t><b>houseage</b> - возраст дома на момент продажи;</t></li>
                <li><t><b>garagecars</b> - количество машиномест в гараже.</t></li>
                </ul>
            <br><br>
            Для надежной оценки доверительных интервалов коэффициентов используется метод HC3, устойчивый к гетероскедастичности.

            <i>Коэффициенты регрессии</i>
            <br><br>
            <div class='picture'>       
                <img src='img/Section4-Linear-models-research/coefficients_table_charachteristics.png'>
                </div>
            <br><br>
            <h4>
                <i>Оценка качества регрессии</i>
                </h4>
            <br><br>
            <i>Визуальная оценка</i>
            <br><br>
            <div class='picture'>       
                <img src='img/Section4-Linear-models-research/regression_diagnostics.png'>
                </div>
            <br><br>
            <i>Результаты статистических тестов и характеристики регрессии</i>
            <br><br>
            <div class='picture'>       
                <img src='img/Section4-Linear-models-research/regression_tests.png'>
                </div>
            <br><br>
            Скорректированный коэффициент детерминации $R^{2}_{adj}$ значим и равен 0.882.
            <br><br>
            Согласно статистическим тестам у нас недостаточно оснований утверждать, что в регрессию включены все предикторы, оказывающие влияние на целевую переменную, и отсутствуют нелинейные взаимосвязи (тест Ramsey, нелинейность остатков). Автокорреляция остатков и мультиколлинеарность не выявлены. Гетероскедастичность остатков нивелируется поправкой HC3. 
            <br><br>
            Ни один тест не дает оснований считать, что остатки распределены нормально. Попробуем удалить крайние элементы ($1.5*IQR$), повторить тесты на нормальность и эксцесс, а также построим график, на котором нормальное распределение с параметрами остатков ($mean$ 0, $std.$ ~0.1243) сравнивается с остатками до и после удаления выбросов. 
            <br><br>
            <i>Тесты на нормальность распределения остатков без выборосов</i>
            <br><br>
            <div class='picture'>       
                <img src='img/Section4-Linear-models-research/residuals_trimmed_tests.png'>
                </div>
            <br><br>
            <i>Коэффициент эксцесса</i>
            <br><br>
            <div class='picture'>       
                <img src='img/Section4-Linear-models-research/residuals_kurtosis.png'>
                </div>
            <br><br>
            <i>Визуализация формы распределения остаков и сравнение с нормальным распределением</i>
            <br><br>
            <div class='picture'>       
                <img src='img/Section4-Linear-models-research/residuals_distributions_comparing.png'>
                </div>
            <br><br>
            Теперь остатки распределены нормально, и в целом форма остатков без удаления выбросов отличается от формы нормального распределения с заданными параметрами только наличием хвостов, что сказывается и на величине эксцесса. Возможно, структура цены нескольких элементов выбивается из общей картины. Можно предположить сознательное снижение/завышение цены при продаже дома.
            <br><br>
            <h4>
                <i>Интерпретация коэффициентов</i>
                </h4>
            <br><br>
            Все оценки действиетельны при прочих равных:
            <br><br>
            <ul>
                <li><t><b>lg_flrsfmean</b> - при увеличении средневзвешенной площади этажей на 1 %, цена увеличивается на 0.144 %;</t></li>
                <li><t><b>overallqual</b> - при увеличении качества материалов на 1 пункт, цена увеличивается на 8.8 %;</t></li>
                <li><t><b>houseage</b> - при увеличении возраста дома на 1 год цена уменьшается на 8.5 %;</t></li>
                <li><t><b>lg_lotarea</b> - при увеличении площади придомовой территории на 1 %, цена увеличивается на 0.0612 %;</t></li>
                <li><t><b>overallcond</b> - при увеличении оценки состояния дома на 1 пункт, цена увеличивается на 0.0558 %;</t></li>
                <li><t><b>bsmtqual</b> - при увеличении оценки качества подавала на 1 пункт, цена увеличивается на 0.0459 %;</t></li>
                <li><t><b>garagecars</b> - при увеличении количество машиномест на 1 единицу, цена увеличивается на 0.0316 %;</t></li>
                <li><t><b>kitchenqual</b> - при увеличении оценки качества кухни на 1 пункт, цена увеличивается на 0.0266 %;</t></li>
                <li><t><b>exterqual</b> - при увеличении оценки качества материала фасада на 1 пункт, цена увеличивается на 0.0203 %;</t></li>
            </ul>
            <br><br>
            <h4>
                <i>Вывод</i>
                </h4>
            <br><br>
            Линейная регрессия объясняет 88% изменчивости целевой переменной, что является хорошим результатом. Используемые предикторы значимы, понятны и легко интерпретируемы. Тем не менее, модель не в полной мере соответствует имеющимся данным. Это объяснимо, если учесть тот факт, что не были использованы такие важные признаки, как <b>neighborhood</b> или <b>functional</b>.
            </p>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h3>
        <a
            class='anchor'
            id='simulations'>
            </a>
        11.3. Результаты линейных моделей на сэмплированных данных
        </h3>
    <div class='text'>
        <p>
            Сгенерированные с помощью симуляций подвыборки данных не содержат дополнительной информации. Тем не менее, если предположить, что исходный датасет достаточно точно отражают генеральную совокупность, результаты симуляций могут быть полезны для оценки дисперсии прогнозов.
            <br><br>
            Симуляции проводились на 1000 сэмплах с повторением (число элементов в сэмпле и исходных данных одинаково). 
Ошибки RMSE составили 0.1352 для обученной в п.12.2. линейной регрессии и 0.1347 для эластичной сети с гиперпараметрами {'alpha': 0.0067, 'l1_ratio': 0.1}.
            <br><br>
            <div class='picture'>       
                <img src='img/Section4-Linear-models-research/simulations.png'>
                </div>
            <br><br>
            Прогнозы отдельно взятых элементов практически не различаются (что показывают предиктивные интервалы). Однако на длинной дистанции (для бóльшего числа элементов) в среднем эффективность эластичной сети выше, поэтому она будет включена в итоговое сравнение. 
            </p>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h2>
        <a
            class='anchor'
            id='residuals'>
            </a>
        12. Выбор алгоритма машинного обучения для прогнозирования остатков линейной регрессии
        </h2>
    <div class='text'>
        <p>
            В этом разделе выбирается алгоритм для прогнозирования остатков линейной регрессии (12.1., 12.2., 12.3.). После этого создается класс <b>HousePricePredictor</b>, который объединяет в себе линейную регрессию на первом уровне и оценщик остатков на втором уровне (12.4.).
            </p>
        </div>
    <h3>
        <a
            class='anchor'
            id='ml_simple'>
            </a>
        12.1. Опорные вектора, бустинги, бэггинг, случайный лес, K-ближайших соседей
        </h3>
    <div class='text'>
        <p>
            На первом этапе обучаются следюущие ML-модели: 
            <ul>
                <li><t><b>KNN</b> - K-Nearest Neighbors;</t></li>
                <li><t><b>SVR</b> - Support Vector Machine;</t></li>
                <li><t><b>RF</b> - Random Forest;</t></li>
                <li><t><b>Bagging</b> - Bagging Regressor;</t></li>
                <li><t><b>LGBoost</b> - Light Gradient Boosting;</t></li>
                <li><t><b>HGBoost</b> - Histogram-based Gradient Boosting;</t></li>
                <li><t><b>XGBoost</b> - Extreme Gradient Boosting.</t></li>
                </ul>
            В качестве предикторов используются все сгенерированные в предыдущих пунктах признаки, а также прогнозы линейной регрессии (предиктор <b>price_pred_lr</b>).
            <br><br>
            Алгоритмы <b>Random Forest, Bagging, LGBoost, XGBoost</b> имеют встроенный функционал отбора наиболее информативных признаков. Отобразим топ-10 наиболее важных признаков для каждой из моделей.
            <br><br>
            <div class='picture'>       
                <img src='img/Section5-Residuals-prediction/features_importance_four_models.png'>
                </div>
            Наиболе значимые признаки здесь:
            <br><br>
            <ul>
                <li><t><b>neighborhood</b> - район расположения дома, он вошел в топ-3 ключевых признаков каждой из моделей;</t></li>
                <li><t><b>lg_bsmtfinsf_first</b> - площадь подвала 1 типа, 3 модели поместили его в топ-3 ключевых признаков;</t></li>
                <li><t><b>price_pred_lr</b> - также в топ-3 у трех моделей, но менее значим, чем <b>lg_bsmtfinsf_first.</b></t></li>
                </ul>
            <i>Число попаданий в топ-10 ключевых признаков</i>
            <br><br>
            <div class='picture'>       
                <img src='img/Section5-Residuals-prediction/features_importance.png'>
                </div>
            <br><br>
            Результаты на 20-фолдовой кросс-валидации выглядят следующим образом (опорные вектора продемонстрировали неожиданно высокий результат).
            <br><br>
            <div class='picture'> 
                <img src='img/Section5-Residuals-prediction/models_residuals.png'>
                </div>
            </p>
        </div>
    <h3>
        <a
            class='anchor'
            id='vote_stack'>
            </a>
        12.2. Добавление оценщиков верхнего уровня - Voting и Stacking
        </h3>
    <div class='text'>
        <p>
            На втором этапе оценивается эффект от поочередного включения в модель оценщиков верхнего уровня.
            </p>
        <p>
            <b>VoteRegressor</b>
            <br><br>
            VoteRegressor формирует свой прогноз, усредняя прогнозы моделей нижнего уровня. Средняя RMSE на 20-фолдовой проверке составила 0.1101.
            <br><br>
            <b>StackingRegressor</b> 
            <br><br>
            В схеме StackingRegressor на верхний уровень добавляется агрегирующий оценщик (в данном случае это __Ridge Regression__), который выдает прогнозы, используя в качестве предикторов прогнозы моделей нижнего уровня. Средняя RMSE на 20-фолдовой проверке: 0.1084.
            <br><br>
            Оба метаоценщика демонстрируют лучшие результаты по сравнению с моделями по-отдельности. Визуализируем результаты их перекрестной проверки.
            <br><br>
            <i>Сравнение Voting и Stacking (20-fold cross-validation)</i>
            <br><br>
            <div class='picture'> 
                <img src='img/Section5-Residuals-prediction/vote_stack_compare.png'>
                </div>
            <br><br>
            Прогнозы <b>Stacking</b> точнее в 14 фолдах из 20.
            </p>
        </div>
    <a
        href="#toc"
        style="font-size:0.9em;">
        Вернуться к содержанию
        </a>
    <h3>
        <a
            class='anchor'
            id='residuals_final'>
            </a>
        12.3. Сравнение всех ML-алгоритмов и выбор оценщика остатков регрессии
        </h3>
    <div class='text'>
        <p>
            Суммарные результаты всех обученных в этом разделе моделей выглядят следующим образом
            <br><br>
            <img src='img/Section5-Residuals-prediction/models_residuals_summary.png'>
            <br><br>
            <i>Визуализация результатов</i>
            <br><br>
            <img src='img/Section5-Residuals-prediction/final_plot.png'>
            <br><br>
            В качестве оценщика остатков будет использоваться <b>Stacking</b>.
            <br><br>
            <i>Конфигурация StackingRegressor</i>
            <br><br>
            <img src='img/Section5-Residuals-prediction/stacking_cofiguration.png'>
            </p>
        </div>
    <h3>
        <a
            class='anchor'
            id='hpp'>
            </a>
        12.4. Финальный оценщик HousePricePredictor
        </h3>
    <div class='text'>
        <p>
            Класс <b>HousePricePredictor</b> объединяет линейную регрессию и <b>Stacking</b> в единую модель. Линейная регрессия генерирует основные прогнозы цены, а <b>Stacking</b> используется для коррекции и повышения точности прогнозов.
            <br><br>
            <img src='img/Section5-Residuals-prediction/hpp.png'>
            <br><br>
            <b>HousePricePredictor</b> поддерживает Scickit-learn-совместимые методы <b>fit</b> и <b>predict</b>, а также ряд других методов (код доступен в файле <i>tools.py</i>)
            <br><br>
            <img src='img/Section5-Residuals-prediction/fit.png'>
            <br><br>
            <img src='img/Section5-Residuals-prediction/predict.png'>
            <br><br>
            Средняя RMSE на 20-фолдовой проверке: 0.1102 +/- 0.009.
            </p>
        </div>
    <a
    href="#toc"
    style="font-size:0.9em;">
    Вернуться к содержанию
        </a>
    <h2>
        <a
            class='anchor'
            id='ml_models'>
            </a>
        13. Обучение независимых ML-моделей
        </h2>
    <div class='text'>
        <p>
            Аналогично выбору прогозирования остатков в первую очередь обучаются популярные ML-алгоритмы, а после этого исследуется влияние оценщиков верхнего уровня <b>Voting</b> и <b>Stacking</b>.
            <br><br>
            Катеориальные признаки кодируются с помощью <b>OrdinalEncoder</b> из библиотеки Feature-engine (категории заменяются целыми числами, порядок которых определяется согласно возрастанию среднего значения целевой переменной).
            <br><br>
            Подбор гиперпаратмеров осуществляется с помощью решетчатого поиска <b>GridSearch</b> от Scikit-learn с <b>20-fold</b> кросс-валиадацией. Чтобы предотвратить утчеку данных во время подбора гиперпараметров используется <b>Pipeline</b> от Scikit-learn.
            <br><br>
            Метрика качества модели - <b>RMSE</b> (среднеквадратичная ошибка).
            <br><br>
            Для оценки вклада предикторов, добавленных в пункте <i>'8. Создание дополнительных предикторов'</i>, модели обучаются с добавлением и без добавления новых признаков.
            <br><br>
            <i>Визуализация результатов</i>
            <br><br>
            <img src='img/Section7-ML-models/ml_models_plot.png'>
            <br><br>
            <i>Средние значения RMSE (20-fold) всех моделей</i>
            <br><br>
            <img src='img/Section7-ML-models/ml_models_table.png'>
            <br><br>
            Ожидаемо, наиболее эффективным алгоритмом оказался <b>Stacking</b>. Его конфигурация идентична модели, выбранной для прогнозирования остатков регрессии.
            <br><br>
            <img src='img/Section7-ML-models/stacking_cofiguration.png'>
            </p>
        </div>
    <h2>
        <a
            class='anchor'
            id='final_results'>
            </a>
        14. Подведение итогов
        </h2>
    <h3>
        <a
            class='anchor'
            id='all_models'>
            </a>
        14.1. Сравнение всех моделей
        </h3>
    <div class='text'>
        <p>
            В данном пункте оценщик HousePricePredictor сравнивается с моделями из предыдущих пунктов. Три базовых модели LightGBM обучены на разных этапах подготовки данных (удаление пропусков, очистка, генерация признаков). Для обучения регрессионной модели (эластичная сеть) используются те же предикторы, которые были использованы для линейной регрессии в HousePricePredictor. Две ML-модели представляют лучшую линейную (SVM) ML-модель ансамблевый алгоритм (Stacking).
            <ul>
                <li><t><b>Base</b> - базовая модель (LightGBM) после удаления пропусков;</t></li>
                <li><t><b>Base (Clean)</b> - промежуточная модель (LightGBM) после очистки данных;</t></li>
                <li><t><b>Base (FE)</b> - промежуточная модель (LightGBM) после генерации новых признаков;</t></li>
                <li><t><b>Elastic Net</b> - лучшая регрессионная модель (эластичная сеть);</t></li>
                <li><t><b>SVM</b> - лучшая линейная модель (SVM);</t></li>
                <li><t><b>Stacking</b> - лучшая ML-модель (Stacking);</t></li>
                <li><t><b>HPP</b> - модель, полученная в результате комбинации линейной регрессии и стэкинга (HousePricePredictor).</t></li>
                </ul>
            <br><br>
            <i>Результаты на тестовом датасете</i>
            <br><br>
            <img src='img/Section8-Final-predictions/final_bar.png'>
            <br><br>
            <i>Сводный график и таблица с результатами</i>
            <br><br>
            <img src='img/Section8-Final-predictions/final_plot.png'>
            <br><br>
            <center>
                <img src='img/Section8-Final-predictions/final_table_T.png'>
                </center> 
            <br><br>
            Ряд комментариев относительно результатов:
            <br><br>
            <ul>
                <li><t>Комбинирование линейной регрессии и алгоритмов машинного обучения превзошли ожидаемые результаты. Итоговый оценщик не только не уступает лучшей модели, но и превосходит её в точности;</t></li>
                <li><t>Очистка и исправление данных увеличили прогнозную точность базовой модели и уменьшили доверительный интревал среднего ошибок;</t></li>
                <li><t>Генерация ноывых признаков сказалась конфигурации базовой модели, но не на на точности прогнозов (при этом нельзя утверждать, что новые признаки бесполезны - они использовались другими моделями, в частности линейной регрессией HousePricePredictor);</t></li>
                - Эластичная сеть ожидаемо продемонстрировала худшие результаты (Во многом это связано с ограниченным числом предикторов в этой модели);</t></li>
                <li><t>Опорные вектора (SVM) неожиданно продемонстрировали сравнительно очень хорошие результаты. По эффективность этот алгоритм уступил только стэкингу (Stacking). Можно предположить, что во многом это обусловлвено общей линейностью в данных;</t></li>
                <li><t>Stacking и HPP показывают хорошую кучность (это видно на нижнем графике swarmplot).</t></li>
                </ul>
            <br><br>
            Дополнительно визуализируем все 20 фолдов кросс-валидации HousePricePredictor и Stacking
            <br><br>
            <img src='img/Section8-Final-predictions/stack_hpp_compare.png'>
            </p>
        </div>
    <a
    href="#toc"
    style="font-size:0.9em;">
    Вернуться к содержанию
        </a>
    <h3>
        <a
            class='anchor'
            id='predicted_actual'>
            </a>
        14.2. Актуальные и спрогнозированные цены
        </h3>
    <div class='text'>
        <p>
            <i>Сопоставление актуальных и спрогнозированных HousePricePredictor цен (элементы по оси Х отсортированы в сторону уеличения суммарной жилой площади)</i>
            <br><br>
            <img src='img/Section8-Final-predictions/predicted_actual_residuals.png'>
            <br><br>
            В первой трети графика видно, что HousePricePredictor излишне оптимитичен и часто переоценивает дома. Во второй трети этот баланс выравнивается, но в третьей части графика появляется снова. По-видимому, выбранная нами архитектура построения модели хорошо подходит для домов среднего размера, но для больших и маленьких домов модель должна быть пересмотрена, что в теории приведет к увеличению воможностей для эффективного прогноза цены.
            </p>
        </div>
    <a
    href="#toc"
    style="font-size:0.9em;">
    Вернуться к содержанию
        </a>
    <h3>
        <a
            class='anchor'
            id='hpp_residuals'>
            </a>
        14.3. Остатки HPP
        </h3>
    <div class='text'>
        <p>
            В данном пункте посмотрим, как ведут себя остатки. В этом проекте немного нарушена последовательность действий. Здесь исследуются результаты прогнозирования на test-датасете. На практике исследование остатков, сравнение актуальной и спрогнозированоой цен необходимо делать на train-датасете, чтобы скорректировать модель и внести концепутаьные исправления перед финальным тестом. Тем не менее, здесь этот требование нарушено, так как проект демонстрационный и не будет развиваться в дальнейшем. 
            <br><br>
            <i>Распределение остатков HousePricePredictor</i>
            <br><br>
            <img src='img/Section8-Final-predictions/hpp_residuals.png'>
            <br><br>
            Ни один тест не дает основания предполагать, что остатки распределены нормально. Попробуем удалить экстремальные значения ошибок (шесть эелментов с остатками более 50000$, см. таблицу ниже).
            <br><br>
            <img src='img/Section8-Final-predictions/residuals_been_cutted.png'>
            <br><br>
            После этого три из пяти тестов указывают на нормальность распределения.
            <br><br>
            <img src='img/Section8-Final-predictions/residuals_cutted_tests.png'>
            <br><br>
            <i>Сравнение формы распределения остатков (до и после удаления выбросов) с формой нормального распределения</i>
            <br><br>
            <img src='img/Section8-Final-predictions/residuals_distributions_compare.png'>
            <br><br>
            Это подтверждает предположение о наличии несколько элементов, которые не вписыааются в общий контекст. Возможно по причине ошибки ввода данных или мошенничестве при заключении сделки о продаже дома.
            <br><br>
            Далее отобразим взаимосвязь актуальных и спрогнозированных цен. Область между 100000 и 200000 имеет низкую дисперсию, в то время как у более дорогих домов разброс сильнее. 
            <br><br>
            <img src='img/Section8-Final-predictions/actual_predicted.png'>
            <br><br>
            Попробуем определить предиктор, который наилучшим образом отражает эту закономерность. После ряда тестов выяснилось, что таким предиктором является суммарная площадь жилых помещений <b>grlivarea</b> (что логично, так как этот признак наиболее сильно коррелирует с ценой).
            <br><br>
            Рассчитаем <b>абсолютные</b> и <b>относительные ошибки</b> и отобразим их взаимосвязь с <b>grlivarea</b>. 
            <br><br>
            <h4>
                <i>Абсолютные ошибки</i>
                </h4>
            <br><br>
            Для домов с суммарной жилой площадью менее 1900 футов RMSE равна 0.084705. С увеличением площади дома значительно возрастает и дисперсия прогнозов - RMSE равна 0.132874. 
            <br><br>
            <img src='img/Section8-Final-predictions/grlivarea_residuals.png'>
            <br><br>
            <h4>
            <i>Относительные ошибки (предсказанная цена относительно актуальной цены)</i>
                </h4>
            <br><br>
            С другой стороны, если взглянуть на относительные ошибки, то зависимость от величины жилого пространства менее очевидна. Можно увидеть некоторые паттерны, если дополнительно построить линии локальной регрессии (LOWESS). Форма остатков в левой части графика напоминает форму вогнутой пораболы с вершиной в районе площади, равной 1250. В правой же части графика явно-выраженная закономерность отсутствует (что может быть следствием недостаточного числа элементов).
            <br><br>
            <img src='img/Section8-Final-predictions/grlivarea_residuals_frac.png'>
            </p>
        </div>
    <a
    href="#toc"
    style="font-size:0.9em;">
    Вернуться к содержанию
        </a>
    <h3>
        <a
            class='anchor'
            id='further'>
            </a>
        14.4. Дальнейшие шаги
        </h3>
    <div class='text'>
        <p>
            <h4>
                <i>Предложение 1</i>
            </h4>
            В пункте <i>14.3. Остатки HPP</i> показано, что дисперсия остатков увеличивается с увеличением площади дома. Чем больше величина ошибок в абсолютном выражении, тем выше потери от неверное предсказанных цен. Поэтому можно разбить исходные данные на две группы - услвно большие дома с суммарной площадью выше 1900 квадратных футов и маленькие дома с площадью ниже 1900 - и исследовать их отдельно друг от друга, чтобы построить две разные модели.
            <h4>
                <i>Предложение 2</i>
            </h4>
            Используя схему <b>Stacking</b> построить ансамбль, в котором алгоритмы нижнего уровня обучаются не на полных данных, а на группах, сформированных в пункте <i>8. Создание дополнительных предикторов</i> - площадь, география, качество материалов и т.д.
            <h4>
                <i>Предложение 3</i>
            </h4> 
            Предиктор <b>neighborhood</b> имеет высокий коэффициент корреляции (0.81), и высоко котируется большинством моделей машинного обучения. При этом он не использовался для построения линейной регрессии, чтобы не усложнять её интерпретацию. В перспективе можно более детально изучить географию местности и её взаимосвязь с целевой переменной. Возможно, объединить некоторые районы в один предиктор. 
            
            Еще один предиктор, на который стоит обратить внимание - это <b>Functional</b>.
            <br><br>
<a
    href="#start"
    style="font-size:0.9em;">
    Вернуться в начало
        </a>         
  



























    </div> 
    </div>
    </div>
    </div>

<script>
// Get the button
let mybutton = document.getElementById("myBtn");

// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}

// When the user clicks on the button, scroll to the top of the document
function topFunction() {
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
}
</script>

</body>
</html>
