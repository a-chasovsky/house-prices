<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Power Consumption</title>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.png">
    <script id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
        </script>
</head>
<style>
html {
    scroll-behavior: smooth;
}
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto", "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
}
h1 { 
    font-family: system-ui;
    color: #303030;
    font-size: 1.5em;
    font-weight: 600;
    text-align: left;
    line-height: 1.25;
    scroll-margin-top: 15px;
    margin: 30px 0 15px 0;
    }
h2 {
    font-family: system-ui;
    color: #252525;
    font-size: 1.3em;
    font-weight: 600;
    text-align: left;
    line-height: 1.5em;
    scroll-margin-top: 15px;
}
h3 {
    font-family: system-ui;
    color: #252525;
    font-size: 1.15em;
    font-weight: 600;
    text-align: left;
    line-height: 1.25em;
    scroll-margin-top: 15px;
}
h4 {
    font-family: system-ui;
    color: #252525;
    font-size: 1em;
    font-weight: 600;
    text-align: left;
    line-height: 1.25;
    margin-bottom: 0px;
    scroll-margin-top: 15px;
}
h5 {
    font-family: system-ui;
    font-style: italic;
    color: #252525;
    font-size:0.85em;
    font-weight: 400;
    text-align: left;
    line-height: 1.25em;
    margin-top: -5px;
    margin-bottom: 0px;
    scroll-margin-top: 15px;
}
p {
    font-family: system-ui;
    font-size: 1em;
    color: #151515;
    line-height: 1.5;
    margin: 12.5px 0 0 0;
    text-align: justify
}
main-container {
    display: grid;
    grid-template-columns: 22.5% 77.5%;
    width: 100%;
    margin: 0 0 75px 0;
}
main-container > nav {
    position: sticky;
    top: 60px;
    align-self: start;
}
sub-container {
    display: block;
    width: 810px;
}
content-container {
    display: block;
    width: 810px;
    border-right: 1px solid #CFD7DE;
    border-left: 1px solid #CFD7DE;
    padding: 0 30px 0 30px;
}
section {
    scroll-margin-top: 15px;
}
.section-nav {
    width: 99.5%;
    
}
.section-nav a:link,
.section-nav a:visited {
    text-decoration: none;
    display: block;
    color: #909090;
    transition: all 25ms ease-in-out;
    padding-right: 20px;
    padding-left: 0px;
}
.section-nav a:hover,
.section-nav a:focus {
    color: #164B84;
    font-weight:500
}
.section-nav ol {
    list-style: none;
    padding-left: 20px;
    margin-top:0;
}
.section-nav ul {
    list-style: none;
    margin-left: 10px;
}
.section-nav li {
    font-size: 0.9rem;
    text-align: left;
}
.section-nav li.active > a {
    color: #164B84;
    font-weight:500
}
ul {
    list-style-type: disc;
    line-height: 1.5;
    margin-top: 5px;
    color: #151515;
    }
li {
    font-family: system-ui;
    line-height: 1.75em;
    text-align: justify
}
img-center {
    display: flex;
    justify-content: center;
    padding-right: 0px;
    padding-left: 0px
}
img-margin {
    margin-left: 30px;
}
space {
    display: block;
    margin-top: 12.5px;
    content: ' '
}
space20 {
    display: block;
    margin-top: 20px;
    content: ' '
}
space25 {
    display: block;
    margin-top: 25px;
    content: ' '
}
a {
    scroll-margin-top: 15px;
}
a:link {
    font-family: system-ui;
    text-decoration: none;
    color: #164B84;
}
a:visited {
    font-family: system-ui;
    color: #164B84;
}
a:hover {
    font-family: system-ui;
    color: #2373C7;
    text-decoration: none;
}
a:active {
    font-family: system-ui;
    color: #2D8CF1;
}
sb {
    font-weight: 600;
    font-color: red;
}
#toTocBtn {
    display: none;
    position: fixed;
    margin-left: 875px;
    bottom: 35px;
    z-index: 99;
    border: none; 
    outline: none; 
    background-color: #F1F1F1;
    color: #1B60AA; 
    cursor: pointer; 
    padding: 15px; 
    border-radius: 5px;
    font-size: 1.15em;
}
#toTocBtn:hover {
    background-color: #E1E1E1;
    border: none; 
    color: #1B60AA;
}
span.emoji {
    font-size: 20px;
}
</style>  
<body>   
<main-container>
    <nav class='section-nav'>
    <ol>
        <li style='padding-left:14px;margin-bottom:5px;'>
            <a href="#begin" style='color:#404040'>Содержание</a></li>
        <li><a href="#review">1. Обзор и краткие результаты</a></li>
        <li style='margin-top:5px;margin-bottom:5px;color:#404040;'>Секция I. Исследование и подготовка данных</li>
        <li><a href="#dataset_description">2. Описание датасета</a></li>
        <li><a href="#missed_values">3. Заполнение отсутствующих значений</a></li>
        <!-- <li1><a href="#model_base">4. ML-модель №1 (базовая)</a></li1>
        <li1><a href="#eda">5. Исследование данных</a></li1>
        <li1><a href="#clear">6. Очистка и проверка на несоответствие</a></li1>
        <li1><a href="#model_inter1">7. ML-модель №2 (после очистки данных)</a></li1>
        <li1><a href="#feature_engineering">8. Создание дополнительных предикторов (feature engineering)</a></li1>
        <li1><a href="#preprocessing">9. Предварительная подготовка данных</a></li1>
        <li1><a href="#model_inter2">10. ML-модель №3 (после создания новых признаков)</a></li1>
        <li1><a href="#section2"><i>Секция 2. Регрессионный анализ</i></a></li1>
        <li1><a href="#elastic_net">11. Эластичная сеть</a></li1>
        <li1><a href="#linear_regression">12. Линейная регрессия</a></li1>
        <li1><a href="#simulations">13. Результаты линейных моделей на сэмплированных данных</a></li1>
        <li1><a href="#section3"><i>Секция 3. Машинное обучение</i></a></li1>
        <li1><a href="#ml_algorithms">14. Выбор ML-модели для прогнозирования остатков линейной регрессии</a></li1>
        <u1l>
            <li1><a href="#ml_simple">14.1. Опорные вектора, бустинги, бэггинг, случайный лес, K-ближайших соседей</a></li1>
            <li1><a href="#vote_stack">14.2. Добавление оценщиков верхнего уровня - Voting и Stacking</a></li1>
            <li1><a href="#residuals_final">14.3. Сравнение всех моделeй и выбор финального оценщика остатков регрессии</a></li1>
            <li1><a href="#hpp">14.4. Объединение линейной регрессии и ML-алгоритма в итоговый оценщик HPP</a></li1>
            </ul1>
        <li1><a href="#ml_models">15. Оценка независимых ML-моделей</a></li1>
        <li1><a href="#section4"><i>Секция 4. Подведение итогов</i></a></li1>
        <li1><a href="#comparison">16. Сравнение всех моделей</a></li1>
        <li1><a href="#actual_predicted_prices">17. Актуальные и спрогнозированные цены</a></li1>
        <li1><a href="#residuals_hpp">18. Анализ остатков HPP</a></li1>
        <li1><a href="#further">19. Дальнейшие шаги</a></li1> -->
        </ol>
  </nav>
<sub-container id='begin' style='scroll-margin-top: 15px;'>
    <img 
        src='img/header.png'
        style='width:760px;padding-left:30px'>
<content-container style='border:none'>
    <h1>
       Сочетание регрессионного анализа и машинного обучения для повышения точности и интерпретируемости модели
        </h1>
    <h5>
       Регрессионный анализ, машинное обучение, описательная аналитика, предиктивная аналитика
        </h5>
    <span style='margin-top:30px;margin-bottom:5px;padding-left:17px;display:inline-block;scroll-margin-top:15px;' id='links'>
        <a href='https://github.com/a-chasovsky/kgl_house_prices' target='_blank'>
            <span class='emoji' style='vertical-align: -0.05em;'>
                &#127969;
                </span>
            <span style='margin-left:3px;font-size:0.85em'>
                Ссылка на репозиторий
                </span>
            </a>
            &emsp;
        </span>
    <span style='margin-top:30px;margin-bottom:5px;display:inline-block;scroll-margin-top:15px;'>
        <a href='https://github.com/a-chasovsky' target='_blank'>
            <span>
                <img src='img/logo-github.png' style='width:20px;vertical-align:top'>
                </span>
            <span style='margin-left:3px;font-size:0.85em'>
                Профиль Github 
                </span>
            </a>
        </span>
    </content-container>
<content-container style='border-right:none;'>
    <button onclick="scrollToID('begin')" id="toTocBtn">
            Наверх
            </button>
        <h2>
        1. Обзор и краткие результаты 1
            </h2>
    <content-container style='border-left:none;padding-left:0;'>
        <section id='review' style='scroll-margin-top: 65px;'>
        <p style='margin:0;'>
            Современные алгоритмы машинного обучения обычно превосходят классические линейные модели в точности прогнозов, но при этом сложны в интерпретации. Некоторые алгоритмы имеют встроенный функционал приоритизации предикторов, но этого недостаточно для оценки взаимосвязей в данных.<br>
            <space></space>
            Целью данного проекта является создание простой в интерпретации модели <sb>HousePricePredictor</sb>, которая по точности прогнозов не уступает лучшим алгоритмам машинного обучения. Модель состоит из двух уровней: на первом уровне линейная регрессия формирует первичные прогнозы и коэффициенты для интерпретации; второй уровень - это алгоритм машинного обучения, который прогнозирует величину остатков (ошибок) регрессии и корректирует результаты. Эта схема во многом напоминает первую итерацию бустинга, в котором каждая последующая итерация минимизирует ошибку предыдущей.
            </p>
        <h3>
            Этапы
            </h3>
        <h4>
            <i>Секция I: Исследование и подготовка данных</i>
            </h4>
        <p>
            На первом этапе проводится первичный анализ данных, визуализация, а также необходимые преобразования. Среди прочего заполняются пропущенные значения, выявляются и исправляются противоречия в данных, определяются наиболее значимые и создаются дополнительные предикторы, данные кодируются и стандартизируются. По итогам каждого этапа преобразований обучается промежуточная ML-модель LightGBM. 
            <space></space>
            <i>Результаты:</i>
            </p>
        <ul>
            <li>очищенный и преобразованный датасет;</li>
            <li>датасеты для пайплайнов секции машинного обучения;</li>
            <li>три промежуточные ML-модели.</li>
        </ul>
        <h4>
            <i>Секция II: Регрессионный анализ</i>
            </h4>
        <p>
            В этом разделе рассматриваются две регрессионные модели: эластичная сеть и линейная регрессия (без регуляризации). 
Для эластичной сети подбирается оптимальное значение гиперпараметра \( \alpha \) и строится график зависимости RMSE от числа используемых предикторов. Десять наиболее релевантных предикторов используются для построения линейной регрессии. После диагностики регрессии, она сравнивается с эластичной сетью с применением ресэмплинга.
            <space></space>
            В дальнейшем результаты эластичной сети используются как бенчмарк эффективности линейных регрессионных моделей, а линейная регрессия станет первым уровнем итогового оценщика HPP. 
        <space></space>
        <i>Результаты:</i>
            </p>
        <ul>
            <li>линейная модель для первого уровня итогового оценщика HPP</li>
            <li>эластичная сеть для сравнения с другими моделями.</li>
        </ul>
        <h4>
            <i>Секция III: Машинное обучение</i>
            </h4>
        <p>
            Секция машинного обучения состоит из двух частей.
            <space></space>
            В первой части осуществляется выбор алгоритма, который будет прогнозировать <sb>остатки</sb> (ошибки) линейной регрессии. Здесь оцениваются разные типы ML-алгоритмов: метод ближайших соседей, бэггинг, случайный лес, бустинг, стэкинг. Самый эффективный алгоритм будет использоваться на втором уровне итогового оценщика HPP. Его прогнозы используются для коррекции прогнозов регрессии, что теоретически должно привести к увеличению точности предсказания цены. Для выбора лучшего алгоритма используется 20-фолдовая перекрестная проверка.
            <space></space>
            Во второй части секции по аналогичной схеме с 20-фолдовой кросс-валидацией определяется лучшая модель машинного обучения, прогнозирующая <sb>цену</sb> дома. Эта модель - очередной бенчмарк эффективности (в дополнение к моделям из предыдущих секций) для итогового оценщика HPP.
            <space></space>
            <i>Результаты:</i>
            </p>
        <ul>
            <li>ML-модель для прогноза остатков регрессии;</li>
            <li>ML-модель для прогноза цены дома.</li>
            </ul>
        <h4>
            <i>Секция IV: Подведение итогов</i>
            </h4>
        <p>
            На заключительном этапе проводится сравнение имеющихся моделей, делается заключение об эффективности оценщика HPP, исследуются остатки его прогнозов, предлагаются шаги для дальнейшего исследования данных и развития структуры HPP.
        <space></space>
        <i>Результаты:</i>
            </p>
        <ul>
            <li>оценка HPP;</li>
            <li>рекомендации по дальнейшим шагам.</li>
        </ul>
        <h3>
            Результаты
            </h3>
        <h4>
            <i>Предсказательная эффективность HousePricePredictor (HPP)</i>
            </h4>
        <p>
            График демонстрирует эффективность прогнозирования семи моделей, построенных на разных стадиях проекта.
            </p>
            <ul>
                <li>Base - базовая модель LightGBM после удаления пропусков;</li>
                <li>Base (Clean) - промежуточная модель LightGBM после очистки данных;</li>
                <li>Base (FE) - промежуточная модель LightGBM после генерации новых признаков;</li>
                <li>Elastic Net - лучшая регрессионная модель (эластичная сеть);</li>
                <li>SVM - лучшая линейная ML-модель;</li>
                <li>Stacking - лучшая ML-модель;</li>
                <li>HousePricePredictor(HPP) - модель, полученная в результате комбинации линейной регрессии и стэкинга.</li>
            </ul>
            <img 
                src='img/Section8-Final-predictions/final_plot.png'
                style="display:block;background-color:#FFFFFF;"
                onclick='clickSize(this)'>
            <space></space>
        <p>
            В ходе проекта удалось снизить ошибку RMSE c 0.1216 у базовой модели до 0.0969 итогового оценщика HousePricePredictor. На этапе преобразования наибольший вклад внесла очистка данных, а несколько дополнительно сгенерированных предикторов полезны как для линейной регрессии, так и для более сложных алгоритмов машинного обучения (см. <i>'8. Создание дополнительных предикторов'</i>, <i>'12. Линейная регрессия'</i>, <i>'15. Оценка независимых ML-моделей'</i>).
            <space></space>
            Результат итогового оценщика HPP превысил ожидания - это единственная модель, у которой ошибка на тестовых данных не превышает 0.1. Доверительные и предиктивные интервалы для всех моделей примерно одинаковы.
            <space></space>
            Три лучшие модели демонстрируют неплохую дисперсию - их результаты на кросс-валидации достаточно кучны, за исключением нескольких выбросов (см. нижний график). Для HPP это пять элементов с заметно более высоким значением ошибки.
            </p>
        <h4>
            <i>Интерпретациия модели</i>
            </h4>
        <p>
            Ядром HousePricePredictor является классическая линейная регрессия. Коэффициенты и доверительные интервалы представлены в таблице ниже.
            <space20></space20>
            <img-margin>
                <img 
                    src='img/Section4-Linear-models-research/coefficients_table.png'
                    style='border: 1px solid #CCCCCC;border-radius: 3px;'>
                </img-margin>
            <space></space>
            Предикторы с наибольшими коэффициентами - <sb>lg_flrsfmean</sb> (дополнительно сгенерированный предиктор - средневзвешенная площадь первого и второго этажей, см. <i>'8.1. Предикторы, характеризующие площадь'</i>), <sb>overallqual</sb> (качество строительных и отделочных материалов) и <sb>houseage</sb> (возраст дома). 
            <space></space>
            Оценка вклада каждого из этих параметров (при прочих равных):
            </p>
            <ul>
                <li>С увеличением средневзвешенной площади этажей на 1% цена увеличивается на 0.144%;</li>
                <li>С увеличением качества материалов на 1 пункт цена увеличивается на 8.8%;</li>
                <li>С увеличением возраста дома на 1 год цена уменьшается на 8.5%</li>
            </ul>
        <p>
            Интерпретацию остальных коэффициентов см. в разделе <i>'12. Линейная регрессия'.</i>
            </p>
        <h4>
            <i>Визуализация актуальных и предсказанных HousePricePredictor цен</i>
            </h4>
            <space></space>
            <img-center>
                <img
                    src='img/Section8-Final-predictions/predicted_actual_residuals.png'
                    style="display:block;background-color:#FFFFFF;" width="100%" height="100%"
                    onclick='clickSize(this)'>
                </img-center>
            <space></space>
        <p>
            Ось абсцисс - элементы, отсортированные по суммарной площади первого и второго этажа <sb>grlivarea</sb>. Визуально этот график можно разбить на три составляющие: малые, средние и большие дома. Модель чаще переоценивает небольшие дома, значения ошибок при этом относительно невелики. На среднем отрезке ошибки увеличиваются и становятся более симметричными. Для больших домов вновь чаще наблюдается переоценка, а ошибки иногда превышают 50000$.
        </p>
        </section>
        <h2 id="section1">
            Секция I. Исследование и подготовка данных
            </h2>
    <section id="dataset_description">
        <h2>
            2. Описание датасета
            </h2>
        <p>
            В проекте используется один из датасетов, опубликованных на Kaggle. Это задача регрессии, в которой требуется спрогнозировать стоимость дома, используя значения его характеристик и исторические данные о предыдущих сделках.
            <space></space>
        <a
            href='https://www.kaggle.com/competitions/house-prices-advanced-regression-techniques/overview'
            target='_blank'
            >Перейти к странице датасета на сайте Kaggle
            </a>
            <space></space>
            </p>
            <ul>
                <li>Число предикторов - 79;</li>
                <li>Число элементов - 1460.</li>
                </ul>
            <space20></space20>
            <img-center>
                <img 
                    src='img/Section1-Overview-and-Base-model/data_raw.png'
                    style='border: 1px solid #CCCCCC;border-radius: 3px;'>
                </img-center>
            <space20></space20>
        <p>
            Данные разбиваются на два датасета в соотношении 9 к 1: обучающий train (1314 элемента) и проверочный test (146 элемента).
            <space></space>
            </p>
        <h4>
            <i>Целевая переменная</i>
            </h4>  
        <p>
            Распределение целевой переменной напоминает гамма-распределение. Это одномодальное распределение с вершиной в районе 150000$ и правосторонней асимметрией.
            <space></space>
            <img src='img/Section1-Overview-and-Base-model/target_distribution.png'>
            <space></space>
            Для выравнивания формы распределения и снижения влияния экстремальных значений используется натуральный логарифм.
            <space></space>
            <img src='img/Section1-Overview-and-Base-model/target_distribution_log.png'>
            </p>
            <h4>
                <i>Характеристики</i>
                </h4>
        <p>
            В датасете 79 независимых переменных:
            </p>
            <ul>
                <li>Количественные признаки - 34;</li>
                <li>Категориальные признаки - 45:</li>
                <ul style='list-style-type:"-  ";'>
                    <li style='margin-left:-15px'>Порядковые - 18;</li>
                    <li style='margin-left:-15px'>Номинативные - 27.</li>
                    </ul>
            </ul>
        <h4>
            <i>Группы предикторов</i>
            </h4>
        <p>
            Для более детального анализа предикторы разделяются на группы. Этот подход полезен для генерации дополнительных признаков, являющихся производными от основных характеристик, а также для очистки и проверки данных на логические противоречия.
            <space></space>
            Сформировано 12 категорий предикторов:
            <ul>
                <li>Качество помещений и материалов;</li>
                <li>Относящиеся к гаражу;</li>
                <li>Относящиеся к подвалу;</li>
                <li>Предикторы, связанные с площадью;</li>
                <li>Типы помещений (комнаты, подвал);</li>
                <li>Год постройки дома/гаража, модернизации, и т.д.;</li>
                <li>Двор и область вокруг дома;</li>
                <li>Строительный материал;</li>
                <li>Конструкционные особенности;</li>
                <li>Состояние (уровень износа);</li>
                <li>Удобства;</li>
                <li>Окружение (район, улица, и т.д.);</li>
                <li>Организационные аспекты продажи.</li>
            </ul>
            </p>
           </section>
    <section id="missed_values">

        
        </section>


























    

<script>
            window.addEventListener('DOMContentLoaded', () => {
            
              const observer = new IntersectionObserver(entries => {
                entries.forEach(entry => {
                  const id = entry.target.getAttribute('id');
                  // if (entry.intersectionRatio > 0) {
                  if (entry.intersectionRatio > 0) {
                    document.querySelector(`nav li a[href="#${id}"]`).parentElement.classList.add('active');
                  } else {
                    document.querySelector(`nav li a[href="#${id}"]`).parentElement.classList.remove('active');
                  }
                });
              });
            
              // Track all sections that have an `id` applied
              document.querySelectorAll('section[id]').forEach((section) => {
                observer.observe(section);
              });
              
            });
            </script>
        </content-container>
    </content-container>
    </sub-container>
    </main-container>
<script>
let mybutton = document.getElementById('toTocBtn');

// When the user scrolls down 20px from the top of the document, show the button
window.onscroll = function() {scrollFunction()};

function scrollFunction() {
  if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
    mybutton.style.display = "block";
  } else {
    mybutton.style.display = "none";
  }
}
// When the user clicks on the button, scroll to the top of the document
// function topFunction() {
//   document.body.scrollTop = 250; // For Safari
//   document.documentElement.scrollTop = 250; // For Chrome, Firefox, IE and Opera
// }
function scrollToID(id) {
    let element = document.getElementById(id);
    element.scrollIntoView({
      block: 'start',
      // behavior: 'smooth',
      inline: 'start'
    });
} 
function clickSize(img) {
      img.classList.toggle('change-size');
    }
    </script>
</body> 